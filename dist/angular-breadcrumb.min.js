/*! angular-breadcrumb - v0.2.3-dev-2014-10-15
* https://github.com/ncuillery/angular-breadcrumb
* Copyright (c) 2014 Nicolas Cuillery; Licensed MIT */
!function(a,b){function c(a,c){return b.equals(a.length,c.length)?a>c:a.length>c.length}function d(a){var b=a.replace(/\n/g," ").match(/^([^(]+?)\s*(\((.*)\))?$/);if(!b||4!==b.length)throw new Error("Invalid state ref '"+a+"'");return{state:b[1],paramExpr:b[3]||null}}function e(){var a={prefixStateName:null,template:"bootstrap3",templateUrl:null};this.setOptions=function(c){b.extend(a,c)},this.$get=["$state","$stateParams","$rootScope",function(b,e,f){var g=f;f.$on("$viewContentLoaded",function(a){c(a.targetScope.$id,g.$id)&&(g=a.targetScope)});var h=function(a){var b=a.parent||(/^(.+)\.[^.]+$/.exec(a.name)||[])[1];return b},i=function(a,c){for(var f,h,i=d(c),j=0,k=a.length;k>j;j+=1)if(a[j].name===i.state)return;f=b.get(i.state),f.abstract||f.ncyBreadcrumb&&f.ncyBreadcrumb.skip||(i.paramExpr&&(h=g.$eval(i.paramExpr)),f.ncyBreadcrumbLink=b.href(i.state,h||e||{}),a.unshift(f))},j=function(a){var c=d(a),e=b.get(c.state);if(e.ncyBreadcrumb&&e.ncyBreadcrumb.parent){var f="function"==typeof e.ncyBreadcrumb.parent,i=f?e.ncyBreadcrumb.parent(g):e.ncyBreadcrumb.parent;if(i)return i}return h(e)};return{getTemplate:function(b){return a.templateUrl?null:b[a.template]?b[a.template]:a.template},getTemplateUrl:function(){return a.templateUrl},getStatesChain:function(){for(var c=[],d=b.$current.self.name;d;d=j(d))i(c,d);return a.prefixStateName&&i(c,a.prefixStateName),c},$getLastViewScope:function(){return g}}}]}function f(a,c,d){return this.$$templates={bootstrap2:'<ul class="breadcrumb"><li ng-repeat="step in steps | limitTo:(steps.length-1)"><a href="{{step.ncyBreadcrumbLink}}">{{step.ncyBreadcrumbLabel}}</a> <span class="divider">/</span></li><li ng-repeat="step in steps | limitTo:-1" class="active"><span>{{step.ncyBreadcrumbLabel}}</span></li></ul>',bootstrap3:'<ol class="breadcrumb"><li ng-repeat="step in steps" ng-class="{active: $last}" ng-switch="$last"><a ng-switch-when="false" href="{{step.ncyBreadcrumbLink}}">{{step.ncyBreadcrumbLabel}}</a> <span ng-switch-when="true">{{step.ncyBreadcrumbLabel}}</span></li></ol>'},{restrict:"AE",replace:!0,scope:{},template:c.getTemplate(this.$$templates),templateUrl:c.getTemplateUrl(),link:{post:function(e){var f=[],g=function(a){if(a.expressions)return a.expressions;var c=[];return b.forEach(a.parts,function(a){b.isFunction(a)&&c.push(a.exp)}),c},h=function(a,c,d){b.forEach(g(a),function(b){var e=c.$watch(b,function(){d.ncyBreadcrumbLabel=a(c)});f.push(e)})},i=function(){b.forEach(f,function(a){a()}),f=[]},j=function(){i();var d=c.$getLastViewScope();e.steps=c.getStatesChain(),b.forEach(e.steps,function(b){if(b.ncyBreadcrumb&&b.ncyBreadcrumb.label){var c=a(b.ncyBreadcrumb.label);b.ncyBreadcrumbLabel=c(d),h(c,d,b)}else b.ncyBreadcrumbLabel=b.name})};d.$on("$viewContentLoaded",function(){j()}),j()}}}}f.$inject=["$interpolate","$breadcrumb","$rootScope"],b.module("ncy-angular-breadcrumb",["ui.router.state"]).provider("$breadcrumb",e).directive("ncyBreadcrumb",f)}(window,window.angular);